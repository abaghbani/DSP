import sys
import numpy as np
import scipy.signal as signal
import matplotlib.pyplot as plt
import mydspclass
myLib = mydspclass.MyDspClass(0)

bitWidth = 2**18
nFilter = 8

Fs   = [240.0,	120.0,	60.0,	30.0,	15.0,	7.5,	7.5,	3.75]
Fcut = [40.8,	16.8,	8.8,	4.8,	2.8,	1.2,	1.2,	0.7]
nTap = [18,		18,		18,		18,		30,		18,		26,		26]

hb = []
for i in range(nFilter):
	b = signal.remez(nTap[i]+1, np.array([0., Fcut[i]/Fs[i], 0.5-Fcut[i]/Fs[i], 0.5]), [1,0])
	b[abs(b) <= 1e-4] = 0.0 # force all even coef to be exact zero (they are close to zero)
	b[int(nTap[i]/2)] = 0.5 # force center coef to be exact 0.5 (it is close to 0.5)
	b = np.round(b*bitWidth)/bitWidth
	hb.append(b)

hbMatlab = []
hbMatlab.append([0.0041656494, 0.0, -0.0141029358, 0.0, 0.0363273621, 0.0, -0.0873146057, 0.0, 0.3115997314, 0.5, 0.3115997314, 0.0, -0.0873146057, 0.0, 0.0363273621, 0.0, -0.0141029358, 0.0, 0.0041656494])
hbMatlab.append([+0.0016479492, +0.0, -0.0087661743, +0.0, +0.0289764404, +0.0, -0.0807418823, +0.0, +0.3089523315, +0.5000000000, +0.3089523315, +0.0, -0.0807418823, +0.0, +0.0289764404, +0.0, -0.0087661743, +0.0, +0.0016479492])
hbMatlab.append([+0.0019836426, +0.0, -0.0096817017, +0.0, +0.0303916931, +0.0, -0.0820884705, +0.0, +0.3095092773, +0.5000000000, +0.3095092773, +0.0, -0.0820884705, +0.0, +0.0303916931, +0.0, -0.0096817017, +0.0, +0.0019836426])
hbMatlab.append([+0.0029792786, +0.0, -0.0119438171, +0.0, +0.0335807800, +0.0, -0.0849761963, +0.0, +0.3106803894, +0.5000000000, +0.3106803894, +0.0, -0.0849761963, +0.0, +0.0335807800, +0.0, -0.0119438171, +0.0, +0.0029792786])
hbMatlab.append([-0.0008430481, +0.0, +0.0026893616, +0.0, -0.0065727234, +0.0, +0.0136947632, +0.0, -0.0260772705, +0.0, +0.0482292175, +0.0, -0.0961418152, +0.0, +0.3148651123, +0.5000000000, +0.3148651123, +0.0, -0.0961418152, +0.0, +0.0482292175, +0.0, -0.0260772705, +0.0, +0.0136947632, +0.0, -0.0065727234, +0.0, +0.0026893616, +0.0, -0.0008430481])
hbMatlab.append([+0.0029792786, +0.0, -0.0119438171, +0.0, +0.0335807800, +0.0, -0.0849761963, +0.0, +0.3106803894, +0.5000000000, +0.3106803894, +0.0, -0.0849761963, +0.0, +0.0335807800, +0.0, -0.0119438171, +0.0, +0.0029792786])
hbMatlab.append([+0.0004425049, 0.0, -0.0022277832, 0.0, +0.0071182251, 0.0, -0.0179901123, 0.0, +0.0402183533, 0.0, -0.0902061462, 0.0, +0.3126716614, 0.5000000000, +0.3126716614, 0.0, -0.0902061462, 0.0, +0.0402183533, 0.0, -0.0179901123, 0.0, +0.0071182251, 0.0, -0.0022277832, 0.0, +0.0004425049])
hbMatlab.append([+0.0017395020, +0.0, -0.0050888062, +0.0, +0.0118675232, +0.0, -0.0241470337, +0.0, +0.0465126038, +0.0, -0.0949554443, +0.0, +0.3144378662, +0.5000000000, +0.3144378662, +0.0, -0.0949554443, +0.0, +0.0465126038, +0.0, -0.0241470337, +0.0, +0.0118675232, +0.0, -0.0050888062, +0.0, +0.0017395020])


# chFltGfsk1M = np.array([-2.8228759766e-04, +4.9667358398e-03, -3.9443969727e-03, -1.2725830078e-02, +2.1667480469e-02, +1.4610290527e-02, -6.1141967773e-02, +1.3160705566e-02, +1.2137603760e-01, -1.1454010010e-01, -2.0558166504e-01, +4.6765136719e-01, +1.0000000000e+00, +4.6765136719e-01, -2.0558166504e-01, -1.1454010010e-01, +1.2137603760e-01, +1.3160705566e-02, -6.1141967773e-02, +1.4610290527e-02, +2.1667480469e-02, -1.2725830078e-02, -3.9443969727e-03, +4.9667358398e-03, -2.8228759766e-04])
# chFltDpsk = np.array([+3.5095214844e-004, -4.4250488281e-004, +4.5776367188e-005, +1.9226074219e-003, -5.3482055664e-003, +4.9438476563e-003, +2.3345947266e-003, -1.9256591797e-002, +5.5557250977e-002, -3.8421630859e-002, -1.9121551514e-001, +4.1075134277e-001, +1.0000000000e+000, +4.1075134277e-001, -1.9121551514e-001, -3.8421630859e-002, +5.5557250977e-002, -1.9256591797e-002, +2.3345947266e-003, +4.9438476563e-003, -5.3482055664e-003, +1.9226074219e-003, +4.5776367188e-005, -4.4250488281e-004, +3.5095214844e-004])
# chFltGfsk2M = np.array([-0.0016098022, -0.0025405884, +0.0059661865, +0.0041198730, -0.0174102783, -0.0008392334, +0.0378952026, -0.0159835815, -0.0671920776, +0.0606842041, +0.1036605835, -0.1659164429, -0.1637573242, +0.5177917480, +1.0000000000, +0.5177917480, -0.1637573242, -0.1659164429, +0.1036605835, +0.0606842041, -0.0671920776, -0.0159835815, +0.0378952026, -0.0008392334, -0.0174102783, +0.0041198730, +0.0059661865, -0.0025405884, -0.0016098022])

for i in range(nFilter):
	print '------------------------------------'
	print '          coeffecient Hb',i
	print '------------------------------------'
	for j in range(nTap[i]+1):
		print ' tap %2d   %+3.6f   %+3.6f' % (j, hb[i][j], hbMatlab[i][j])

for i in range(nFilter):
	w,h = signal.freqz(hb[i],1)
	plt.plot(w/(2*np.pi)*Fs[i], 20 * np.log10(abs(h)), label = 'python')
	w,h = signal.freqz(hbMatlab[i],1)
	plt.plot(w/(2*np.pi)*Fs[i], 20 * np.log10(abs(h)), label = 'matlab')
	plt.title("filter no:"+str(i))
	plt.grid()
	plt.legend(loc='best')
	plt.show()

bitWidth = 2**18
nFilter = 3

Fs   = [1.875,	1.875,	3.75]
Fcut = [0.6,	0.7,	1.2]
nTap = [24,		24,		28]

hb = []
for i in range(nFilter):
	b = signal.remez(nTap[i]+1, np.array([0., Fcut[i]/Fs[i], 0.5-Fcut[i]/Fs[i], 0.5]), [1,0])
	b = np.round(b*bitWidth)/bitWidth
	hb.append(b)

chfilMatlab = []
chfilMatlab.append([-2.8228759766e-04, +4.9667358398e-03, -3.9443969727e-03, -1.2725830078e-02, +2.1667480469e-02, +1.4610290527e-02, -6.1141967773e-02, +1.3160705566e-02, +1.2137603760e-01, -1.1454010010e-01, -2.0558166504e-01, +4.6765136719e-01, +1.0000000000e+00, +4.6765136719e-01, -2.0558166504e-01, -1.1454010010e-01, +1.2137603760e-01, +1.3160705566e-02, -6.1141967773e-02, +1.4610290527e-02, +2.1667480469e-02, -1.2725830078e-02, -3.9443969727e-03, +4.9667358398e-03, -2.8228759766e-04])
chfilMatlab.append([+3.5095214844e-004, -4.4250488281e-004, +4.5776367188e-005, +1.9226074219e-003, -5.3482055664e-003, +4.9438476563e-003, +2.3345947266e-003, -1.9256591797e-002, +5.5557250977e-002, -3.8421630859e-002, -1.9121551514e-001, +4.1075134277e-001, +1.0000000000e+000, +4.1075134277e-001, -1.9121551514e-001, -3.8421630859e-002, +5.5557250977e-002, -1.9256591797e-002, +2.3345947266e-003, +4.9438476563e-003, -5.3482055664e-003, +1.9226074219e-003, +4.5776367188e-005, -4.4250488281e-004, +3.5095214844e-004])
chfilMatlab.append([-0.0016098022, -0.0025405884, +0.0059661865, +0.0041198730, -0.0174102783, -0.0008392334, +0.0378952026, -0.0159835815, -0.0671920776, +0.0606842041, +0.1036605835, -0.1659164429, -0.1637573242, +0.5177917480, +1.0000000000, +0.5177917480, -0.1637573242, -0.1659164429, +0.1036605835, +0.0606842041, -0.0671920776, -0.0159835815, +0.0378952026, -0.0008392334, -0.0174102783, +0.0041198730, +0.0059661865, -0.0025405884, -0.0016098022])

for i in range(nFilter):
	print '------------------------------------'
	print '     coeffecient channel filter',i
	print '------------------------------------'
	for j in range(nTap[i]+1):
		print ' tap %2d   %+3.6f   %+3.6f' % (j, hb[i][j], hbMatlab[i][j])

for i in range(nFilter):
	w,h = signal.freqz(hb[i],1)
	plt.plot(w/(2*np.pi)*Fs[i], 20 * np.log10(abs(h)), label = 'python')
	w,h = signal.freqz(hbMatlab[i],1)
	plt.plot(w/(2*np.pi)*Fs[i], 20 * np.log10(abs(h)), label = 'matlab')
	plt.title("filter no:"+str(i))
	plt.grid()
	plt.legend(loc='best')
	plt.show()
